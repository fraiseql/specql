<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>SpecQL Business Logic Schema - SpecQL Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "SpecQL Business Logic Schema";
        var mkdocs_page_input_path = "architecture/SPECQL_BUSINESS_LOGIC_REFINED.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> SpecQL Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../getting-started/">Getting Started</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../guides/mutation-patterns/">Mutation Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../guides/test-generation/">Test Generation</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../guides/cli/">CLI</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../reference/">Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../examples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../tutorials/">Tutorials</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../best-practices/">Best Practices</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">SpecQL Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">SpecQL Business Logic Schema</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="specql-business-logic-schema">SpecQL Business Logic Schema</h1>
<h2 id="overview">Overview</h2>
<p>SpecQL separates framework concerns from business logic. The framework handles common patterns automatically, while YAML definitions focus on domain-specific rules.</p>
<h2 id="framework-responsibilities">Framework Responsibilities</h2>
<p>The SpecQL framework automatically provides:
- CRUD operation generation
- Input validation and type checking
- Permission checks
- Audit logging
- Event emission
- Standard response formatting
- Exception handling</p>
<h2 id="yaml-focus">YAML Focus</h2>
<p>YAML definitions specify:
- Entity relationships and references
- Business validation rules
- Multi-step workflows
- Domain-specific logic
- Conditional business rules</p>
<h2 id="example">Example</h2>
<pre><code class="language-yaml">entity: Task
fields:
  title: text
  assignee: ref(User)
  status: enum(todo, in_progress, done)

actions:
  - name: create_task
    steps:
      - validate: title IS NOT NULL AND LENGTH(title) &gt;= 3
      - insert: Task

  - name: complete_task
    steps:
      - validate: status = 'in_progress'
      - update: Task SET status = 'done'
</code></pre>
<hr />
<h2 id="specql-language-features-from-tmp-analysis">üéØ SpecQL Language Features (from /tmp/ analysis)</h2>
<h3 id="built-in-framework-capabilities"><strong>Built-in Framework Capabilities</strong></h3>
<pre><code class="language-yaml"># SpecQL provides these automatically:

entity: Task
  fields:
    title: text
    assignee: ref(User)
    status: enum(todo, in_progress, done)

  actions:
    - name: create_task
      # ‚úÖ AUTO: validate inputs (type checking)
      # ‚úÖ AUTO: check permissions (caller context)
      # ‚úÖ AUTO: generate INSERT query
      # ‚úÖ AUTO: emit event('task.created')
      # ‚úÖ AUTO: return mutation_result
      # ‚úÖ AUTO: log to audit trail
      steps:
        - validate: title.length &gt;= 3        # BUSINESS RULE
        - insert: Task                       # FRAMEWORK ACTION
        - notify: assignee(email, 'Task assigned')  # FRAMEWORK ACTION

    - name: move_task
      requires: caller.is_owner OR caller.has_role('admin')  # FRAMEWORK
      steps:
        - validate: new_status IN allowed_transitions(current_status)  # BUSINESS RULE
        - update: status = new_status       # FRAMEWORK ACTION
        - if: new_status == 'done'          # BUSINESS LOGIC
          then: increment(assignee.tasks_completed)  # FRAMEWORK ACTION
</code></pre>
<h3 id="what-this-means"><strong>What This Means</strong></h3>
<p><strong>Framework provides:</strong>
- Type validation
- Permission checks
- Standard mutations (insert/update/delete)
- Event emission
- Notifications
- Audit logging
- Response formatting
- Exception handling</p>
<p><strong>YAML only specifies:</strong>
- Business-specific validation rules
- Domain-specific workflows
- Custom conflict detection
- Conditional business logic</p>
<hr />
<h2 id="revised-yaml-schema-business-focused">üìã Revised YAML Schema (Business-Focused)</h2>
<h3 id="example-1-machine-item-simplified"><strong>Example 1: Machine Item (Simplified)</strong></h3>
<p><strong>Before (Framework + Business Mixed - 200+ lines):</strong></p>
<pre><code class="language-yaml">entity:
  name: machine_item
  business_logic:
    validations: [15 validation rules]
    existence_checks: [5 existence checks]
    conflict_detection: [3 conflict rules]
    nested_creation: [order creation logic]
    side_effects: [charge insertion]
    cascade_updates: [3 refresh operations]
    exception_handling: [4 exception types]
    response_structure: [complex response]
</code></pre>
<p><strong>After (Business-Only - 40 lines):</strong></p>
<pre><code class="language-yaml">entity: MachineItem
  fields:
    machine: ref(Machine)
    source_type: enum(MachineItem, ContractItem, Product)
    source_id: uuid
    order: ref(Order)
    installed_at: timestamp

  actions:
    - name: create_machine_item
      # Framework auto-validates types, permissions, logs, etc.

      steps:
        # Business rule: order_id and order_data are mutually exclusive
        - validate: NOT (order_id IS NOT NULL AND order_data IS NOT NULL)
          error: &quot;conflicting_order_fields&quot;

        # Business rule: Product cannot have orders
        - validate: NOT (source_type = 'Product' AND (order_id IS NOT NULL OR order_data IS NOT NULL))
          error: &quot;invalid_order_usage_with_product&quot;

        # Business rule: nested order creation
        - if: order_data IS NOT NULL
          then:
            - call: create_order(order_data)
            - set: order_id = result.id

        # Business rule: resolve source entity
        - switch: source_type
          cases:
            MachineItem:
              - validate: source.fk_machine IS NULL
                error: &quot;machine_item_already_allocated&quot;
              - update: source SET fk_machine = input.machine_id

            ContractItem:
              - fetch: source AS contract_item
              - set: fk_product = contract_item.fk_product
              - insert: MachineItem

            Product:
              - set: fk_product = source_id
              - insert: MachineItem

        # Business rule: conditional charge creation
        - if: source_type != 'Product'
          then:
            - compute: charge_end_date = resolve_machine_cost_period_end_date(...)
            - validate: installed_at &lt;= charge_end_date
              error: &quot;installation_date_incompatible_with_contract&quot;
            - call: insert_machine_item_charge(...)

      # Framework handles: emit event, notify, audit log, return response
</code></pre>
<p><strong>Reduction: 200 lines ‚Üí 40 lines (80% less YAML)</strong></p>
<hr />
<h3 id="example-2-reservation-simplified"><strong>Example 2: Reservation (Simplified)</strong></h3>
<p><strong>Before (Framework + Business Mixed - 250+ lines)</strong></p>
<p><strong>After (Business-Only - 60 lines):</strong></p>
<pre><code class="language-yaml">entity: Reservation
  table: allocation  # Stored in allocation table
  fields:
    machine: ref(Machine)
    reserved_from: date
    reserved_until: date
    organizational_unit: ref(OrganizationalUnit)
    location: ref(Location)
    is_provisionnal: boolean = true

  actions:
    - name: create_reservation
      # Framework: type checks, permission checks, audit log

      steps:
        # Business rule: date range validation
        - validate: reserved_from &lt;= reserved_until
          error: &quot;invalid_date_range&quot;
        - validate: reserved_from &gt;= CURRENT_DATE
          error: &quot;past_date_not_allowed&quot;

        # Business rule: resolve defaults
        - default: reserved_from = CURRENT_DATE + 1 year
        - default: reserved_until = '2099-12-31'
        - default: organizational_unit = get_or_create_ou_for_reservation(...)
        - default: location = get_legal_location(organization)

        # Business rule: conflict detection (temporal overlap)
        - validate: NOT EXISTS (
            SELECT 1 FROM allocation
            WHERE fk_machine = input.machine_id
              AND is_provisionnal = TRUE
              AND daterange(start_date, end_date) &amp;&amp; daterange(reserved_from, reserved_until)
          )
          error: &quot;overlapping_reservation_exists&quot;
          context:
            - conflict_reservation: tv_allocation WHERE overlap
            - context_machine: tv_machine WHERE id = machine_id

        # Business rule: temporal continuity (close current allocation)
        - find: current_allocation WHERE
            fk_machine = input.machine_id AND
            is_provisionnal = FALSE AND
            start_date &lt;= CURRENT_DATE AND
            end_date &gt;= reserved_from
        - update: current_allocation SET
            end_date = reserved_from - 1 day,
            is_current = recalculate(...)

        # Business rule: insert reservation
        - insert: Allocation(
            machine = input.machine,
            start_date = reserved_from,
            end_date = reserved_until,
            is_provisionnal = true,
            is_stock = false
          )

        # Business rule: update machine flags
        - update: tv_machine SET data-&gt;is_reserved = true
          WHERE id = input.machine_id

      # Framework handles: event emission, notifications, response
</code></pre>
<p><strong>Reduction: 250 lines ‚Üí 60 lines (76% less YAML)</strong></p>
<hr />
<h3 id="example-3-allocation-simplified"><strong>Example 3: Allocation (Simplified)</strong></h3>
<p><strong>Before (Framework + Business Mixed - 180 lines)</strong></p>
<p><strong>After (Business-Only - 45 lines):</strong></p>
<pre><code class="language-yaml">entity: Allocation
  fields:
    machine: ref(Machine)
    organizational_unit: ref(OrganizationalUnit)
    location: ref(Location)
    start_date: date
    end_date: date
    is_provisionnal: boolean = false

  actions:
    - name: create_allocation
      steps:
        # Business rule: check for identical current allocation
        - if: EXISTS current_allocation WITH same orgunit AND location
          then: reject(&quot;current_allocation_is_the_same&quot;)

        # Business rule: handle future provisional allocations
        - find: future_allocations WHERE
            fk_machine = input.machine AND
            start_date &gt; input.start_date AND
            is_provisionnal = TRUE
        - if: future_allocations EXISTS AND NOT input.delete_future_allocations
          then: reject(&quot;future_allocations_exist&quot;)
        - if: input.delete_future_allocations
          then: delete(future_allocations)

        # Business rule: adjust neighboring allocations
        - call: adjust_allocation_neighbors(
            machine = input.machine,
            new_start = input.start_date,
            new_end = input.end_date
          )

        # Business rule: insert allocation
        - insert: Allocation(...)

        # Business rule: update temporal flags
        - call: update_allocation_flags(machine = input.machine)

      on_error:
        overlapping_allocation:
          error: &quot;overlapping&quot;
          context: conflict_allocation

    - name: update_allocation
      steps:
        # Business rule: detect what changed
        - detect_changes: [location, organizational_unit, start_date, end_date]
        - if: no_changes
          then: reject(&quot;noop:no_changes&quot;)

        # Business rule: conditional neighbor adjustment
        - if: start_date changed OR end_date changed
          then: call(adjust_allocation_neighbors(...))

        # Business rule: apply update
        - update: Allocation SET changed_fields

        # Business rule: recalculate temporal fields
        - update: Allocation SET
            is_past = (end_date &lt; CURRENT_DATE),
            is_current = (start_date &lt;= CURRENT_DATE AND end_date &gt;= CURRENT_DATE),
            is_future = (start_date &gt; CURRENT_DATE)
</code></pre>
<p><strong>Reduction: 180 lines ‚Üí 45 lines (75% less YAML)</strong></p>
<hr />
<h2 id="refined-yaml-schema-structure">üèóÔ∏è Refined YAML Schema Structure</h2>
<h3 id="top-level-entity-definition"><strong>Top-Level (Entity Definition)</strong></h3>
<pre><code class="language-yaml">entity: EntityName
  # === Database Mapping ===
  table: string                    # Optional: if different from entity name
  schema: string                   # PostgreSQL schema
  description: string

  # === Fields (Standard) ===
  fields:
    field_name: type               # Simple field
    field_name: ref(Entity)        # Foreign key reference
    field_name: list(ref(Entity))  # Many-to-many
    field_name: enum(val1, val2)   # Enumeration
    field_name: type = default     # With default value

  # === Indexes (Optional) ===
  indexes:
    - columns: [field1, field2]
      type: btree | gin | gist

  # === Business Actions ===
  actions:
    - name: action_name
      requires: permission_expression   # Framework: permission check
      steps: [...]                      # Business logic steps

  # === AI Agents (Optional) ===
  agents:
    - name: agent_name
      type: ai_llm | rule_based
      observes: [event1, event2]
      can_execute: [action1, action2]
      strategy: |
        Business strategy description
      audit: required
</code></pre>
<hr />
<h3 id="action-step-dsl-business-logic"><strong>Action Step DSL (Business Logic)</strong></h3>
<pre><code class="language-yaml">steps:
  # === VALIDATION (Business Rules) ===
  - validate: expression
    error: &quot;error_code&quot;
    context: {...}                    # Optional context for error

  # === CONDITIONAL LOGIC ===
  - if: condition
    then: [steps]
    else: [steps]                     # Optional

  - switch: field
    cases:
      value1: [steps]
      value2: [steps]

  # === DATA RETRIEVAL ===
  - find: entity WHERE conditions    # Find existing entity
  - fetch: entity AS variable        # Load entity data

  # === COMPUTATION ===
  - compute: variable = expression   # Calculate value
  - set: variable = value            # Set variable

  # === DEFAULT VALUES ===
  - default: field = expression      # Set if NULL

  # === DATABASE OPERATIONS ===
  - insert: Entity(fields)           # Framework handles INSERT
  - update: entity SET fields        # Framework handles UPDATE
  - delete: entity                   # Framework handles DELETE

  # === FUNCTION CALLS ===
  - call: function_name(args)        # Call PostgreSQL function
    store: variable_name              # Optional: store result

  # === NESTED OPERATIONS ===
  - increment: field                 # Increment counter
  - decrement: field                 # Decrement counter

  # === FRAMEWORK ACTIONS (Auto-Added) ===
  # emit: event(...)                 # Framework adds automatically
  # notify: user(...)                # Framework adds automatically
  # log: audit(...)                  # Framework adds automatically
</code></pre>
<hr />
<h2 id="framework-vs-business-logic-split">üìä Framework vs Business Logic Split</h2>
<h3 id="framework-responsibilities-auto-generated"><strong>Framework Responsibilities (Auto-Generated)</strong></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>SpecQL Framework Handles</th>
<th>YAML Specifies</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Type Validation</strong></td>
<td>‚úÖ Auto (field types)</td>
<td>Nothing</td>
</tr>
<tr>
<td><strong>Permission Checks</strong></td>
<td>‚úÖ Auto (requires: ...)</td>
<td>Permission expression</td>
</tr>
<tr>
<td><strong>Existence Checks</strong></td>
<td>‚úÖ Auto (ref(...) validation)</td>
<td>Nothing</td>
</tr>
<tr>
<td><strong>CRUD Operations</strong></td>
<td>‚úÖ Auto (insert/update/delete)</td>
<td>Entity + fields</td>
</tr>
<tr>
<td><strong>Event Emission</strong></td>
<td>‚úÖ Auto (entity.action)</td>
<td>Nothing</td>
</tr>
<tr>
<td><strong>Notifications</strong></td>
<td>‚úÖ Auto (notify: ...)</td>
<td>Recipients + message</td>
</tr>
<tr>
<td><strong>Audit Logging</strong></td>
<td>‚úÖ Auto (all mutations)</td>
<td>Nothing</td>
</tr>
<tr>
<td><strong>Response Format</strong></td>
<td>‚úÖ Auto (mutation_result)</td>
<td>Nothing</td>
</tr>
<tr>
<td><strong>Exception Handling</strong></td>
<td>‚úÖ Auto (standard errors)</td>
<td>Custom error codes</td>
</tr>
<tr>
<td><strong>Change Detection</strong></td>
<td>‚úÖ Auto (track fields)</td>
<td>Nothing</td>
</tr>
<tr>
<td><strong>GraphQL Generation</strong></td>
<td>‚úÖ Auto (types + mutations)</td>
<td>Nothing</td>
</tr>
<tr>
<td><strong>TypeScript Types</strong></td>
<td>‚úÖ Auto (codegen)</td>
<td>Nothing</td>
</tr>
</tbody>
</table>
<h3 id="business-logic-responsibilities-yaml"><strong>Business Logic Responsibilities (YAML)</strong></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Business Logic Handles</th>
<th>Framework Assists</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Business Validations</strong></td>
<td>üéØ YAML (validate: ...)</td>
<td>Error formatting</td>
</tr>
<tr>
<td><strong>Conflict Detection</strong></td>
<td>üéØ YAML (EXISTS queries)</td>
<td>Query execution</td>
</tr>
<tr>
<td><strong>Conditional Workflows</strong></td>
<td>üéØ YAML (if/switch)</td>
<td>Step execution</td>
</tr>
<tr>
<td><strong>Multi-Step Actions</strong></td>
<td>üéØ YAML (steps: [...])</td>
<td>Transaction mgmt</td>
</tr>
<tr>
<td><strong>Temporal Logic</strong></td>
<td>üéØ YAML (date comparisons)</td>
<td>Date functions</td>
</tr>
<tr>
<td><strong>Neighbor Adjustment</strong></td>
<td>üéØ YAML (find + update)</td>
<td>Query execution</td>
</tr>
<tr>
<td><strong>Nested Creation</strong></td>
<td>üéØ YAML (call: create_...)</td>
<td>Function call</td>
</tr>
<tr>
<td><strong>Default Resolution</strong></td>
<td>üéØ YAML (default: ...)</td>
<td>NULL handling</td>
</tr>
<tr>
<td><strong>Computed Values</strong></td>
<td>üéØ YAML (compute: ...)</td>
<td>Expression eval</td>
</tr>
<tr>
<td><strong>AI Agents</strong></td>
<td>üéØ YAML (strategy)</td>
<td>Agent runtime</td>
</tr>
</tbody>
</table>
<p><strong>Key Insight</strong>: Framework handles <strong>how</strong> (infrastructure), YAML specifies <strong>what</strong> (business rules).</p>
<hr />
<h2 id="complete-example-crm-contact-specql-style">üí° Complete Example: CRM Contact (SpecQL Style)</h2>
<pre><code class="language-yaml">entity: Contact
  schema: crm
  description: &quot;Customer contact with lead scoring&quot;

  fields:
    first_name: text
    last_name: text
    email: text
    phone: text
    company: ref(Company)
    owner: ref(User)
    status: enum(lead, qualified, customer, inactive)
    lead_score: integer = 0
    tags: list(text)
    custom_fields: jsonb

  indexes:
    - columns: [email]
      type: unique
    - columns: [status, lead_score]
      type: btree

  actions:
    - name: create_contact
      requires: caller.has_permission('create_contact')

      steps:
        # Business validation
        - validate: email MATCHES email_pattern
          error: &quot;invalid_email&quot;
        - validate: phone MATCHES phone_pattern OR phone IS NULL
          error: &quot;invalid_phone&quot;

        # Business rule: deduplication
        - if: EXISTS Contact WHERE email = input.email
          then: reject(&quot;duplicate_email&quot;)

        # Business rule: insert contact
        - insert: Contact(all_fields)

        # Business rule: trigger AI agents
        - trigger: agent('lead_scoring_agent')
        - trigger: agent('enrichment_agent')

    - name: qualify_lead
      requires: contact.status = 'lead' AND caller.is_owner

      steps:
        # Business validation
        - validate: lead_score &gt;= 70
          error: &quot;insufficient_lead_score&quot;

        # Business workflow
        - update: Contact SET status = 'qualified'
        - call: create_opportunity(contact_id = contact.id)

  agents:
    - name: lead_scoring_agent
      type: ai_llm
      observes: ['contact.created', 'activity.logged']
      can_execute: ['update_lead_score', 'qualify_lead']

      strategy: |
        Analyze contact data and score 0-100 based on:
        1. Company size (employees, revenue)
        2. Industry fit (target industries)
        3. Engagement level (emails, calls, meetings)
        4. Budget indicators (custom_fields.budget)

        Scoring thresholds:
        - 0-30: Low priority (routine follow-up)
        - 31-70: Medium priority (nurture campaign)
        - 71-100: High priority (auto-qualify if owner approves)

      audit: required

    - name: enrichment_agent
      observes: ['contact.created']
      can_execute: ['update_contact_data']

      strategy: |
        Call external enrichment API (Clearbit, Apollo):
        1. Fetch company data (size, industry, revenue)
        2. Fetch social profiles (LinkedIn, Twitter)
        3. Validate job title
        4. Update contact.custom_fields with enriched data

      audit: required
</code></pre>
<p><strong>Generated Output (Framework):</strong></p>
<pre><code>‚úÖ PostgreSQL table: crm.tb_contact
‚úÖ PostgreSQL view: crm.v_contact (with JSONB data column)
‚úÖ SQL function: crm.fn_create_contact(...)
‚úÖ SQL function: crm.fn_qualify_lead(...)
‚úÖ GraphQL type: Contact
‚úÖ GraphQL mutations: createContact, qualifyLead
‚úÖ GraphQL queries: contact(id), contacts(where, orderBy)
‚úÖ TypeScript types: Contact, CreateContactInput, QualifyLeadInput
‚úÖ Agent runtime config: lead_scoring_agent, enrichment_agent
‚úÖ Test suite: 25 auto-generated tests
‚úÖ Documentation: API docs + OpenAPI spec
</code></pre>
<p><strong>Result:</strong>
- <strong>YAML</strong>: 60 lines (business logic only)
- <strong>Generated Code</strong>: 2,000+ lines (framework)
- <strong>Time</strong>: 2 hours YAML + 5 minutes compilation</p>
<hr />
<h2 id="implementation-strategy-revised">üöÄ Implementation Strategy (Revised)</h2>
<h3 id="phase-1-framework-foundation-week-1-2"><strong>Phase 1: Framework Foundation (Week 1-2)</strong></h3>
<p><strong>Build SpecQL Compiler:</strong>
- ‚úÖ Parse YAML entity definitions
- ‚úÖ Generate PostgreSQL tables + views
- ‚úÖ Generate standard CRUD functions
- ‚úÖ Generate GraphQL schema
- ‚úÖ Generate TypeScript types</p>
<p><strong>Deliverable</strong>: Basic CRUD works end-to-end</p>
<hr />
<h3 id="phase-2-action-step-dsl-week-3-4"><strong>Phase 2: Action Step DSL (Week 3-4)</strong></h3>
<p><strong>Implement Business Logic Steps:</strong>
- ‚úÖ <code>validate: expression</code> ‚Üí SQL validation
- ‚úÖ <code>if/then/else</code> ‚Üí PL/pgSQL conditionals
- ‚úÖ <code>insert/update/delete</code> ‚Üí SQL operations
- ‚úÖ <code>call: function(...)</code> ‚Üí Function invocation
- ‚úÖ <code>find/fetch</code> ‚Üí SQL queries</p>
<p><strong>Deliverable</strong>: Business workflows compile to SQL</p>
<hr />
<h3 id="phase-3-advanced-patterns-week-5-6"><strong>Phase 3: Advanced Patterns (Week 5-6)</strong></h3>
<p><strong>Implement Complex Features:</strong>
- ‚úÖ Conflict detection (EXISTS queries)
- ‚úÖ Temporal logic (date ranges)
- ‚úÖ Neighbor adjustment (UPDATE chains)
- ‚úÖ Nested creation (function calls)
- ‚úÖ Computed values (expressions)</p>
<p><strong>Deliverable</strong>: Complex business logic supported</p>
<hr />
<h3 id="phase-4-ai-agents-week-7-8"><strong>Phase 4: AI Agents (Week 7-8)</strong></h3>
<p><strong>Implement Agent Runtime:</strong>
- ‚úÖ Agent sandbox (isolated execution)
- ‚úÖ Event observation (trigger on events)
- ‚úÖ Action execution (controlled permissions)
- ‚úÖ LLM integration (OpenAI, Claude)
- ‚úÖ Audit trail (all agent actions logged)</p>
<p><strong>Deliverable</strong>: AI-powered automation</p>
<hr />
<h3 id="phase-5-production-ready-week-9-10"><strong>Phase 5: Production Ready (Week 9-10)</strong></h3>
<p><strong>Polish &amp; Optimize:</strong>
- ‚úÖ Error messages (business-friendly)
- ‚úÖ Performance (query optimization)
- ‚úÖ Testing (auto-generated tests)
- ‚úÖ Documentation (auto-generated docs)
- ‚úÖ Migration path (existing ‚Üí SpecQL)</p>
<p><strong>Deliverable</strong>: Production-ready platform</p>
<hr />
<h2 id="key-benefits-of-specql-approach">üéØ Key Benefits of SpecQL Approach</h2>
<h3 id="1-massive-reduction-in-yaml-verbosity"><strong>1. Massive Reduction in YAML Verbosity</strong></h3>
<p><strong>Before</strong> (Framework + Business Mixed):</p>
<pre><code class="language-yaml"># 250 lines of YAML for reservation
business_logic:
  validations: [15 rules with error handling]
  existence_checks: [5 checks with error messages]
  conflict_detection: [3 complex checks]
  exception_handling: [4 exception types]
  response_structure: [complex response building]
  # ... etc
</code></pre>
<p><strong>After</strong> (Business-Only):</p>
<pre><code class="language-yaml"># 60 lines of YAML for reservation
actions:
  - name: create_reservation
    steps:
      - validate: reserved_from &lt;= reserved_until
      - validate: NOT EXISTS overlapping_reservation
      - insert: Reservation(...)
      # Framework handles the rest automatically
</code></pre>
<p><strong>Reduction: 75-80% less YAML</strong></p>
<hr />
<h3 id="2-clear-separation-of-concerns"><strong>2. Clear Separation of Concerns</strong></h3>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Responsibility</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Framework</strong></td>
<td>Infrastructure (CRUD, events, audit, errors)</td>
<td>SpecQL Compiler</td>
</tr>
<tr>
<td><strong>Business</strong></td>
<td>Domain rules (validations, workflows, agents)</td>
<td>YAML Specification</td>
</tr>
<tr>
<td><strong>UI</strong></td>
<td>Presentation (forms, lists, dashboards)</td>
<td>React + Generated Hooks</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="3-framework-evolution-without-yaml-changes"><strong>3. Framework Evolution Without YAML Changes</strong></h3>
<p><strong>Example: Improve Error Handling</strong></p>
<pre><code class="language-yaml"># YAML stays the same
steps:
  - validate: email MATCHES email_pattern
    error: &quot;invalid_email&quot;
</code></pre>
<p><strong>Framework Evolution:</strong></p>
<pre><code class="language-sql">-- V1: Simple error
IF NOT (email ~ email_pattern) THEN
  RETURN error('invalid_email');
END IF;

-- V2: Better error (framework update, no YAML change)
IF NOT (email ~ email_pattern) THEN
  RETURN error('invalid_email',
    message =&gt; format('Email %s is invalid', email),
    field =&gt; 'email',
    suggestion =&gt; 'Use format: name@domain.com'
  );
END IF;
</code></pre>
<hr />
<h3 id="4-ai-agent-integration-built-in"><strong>4. AI Agent Integration (Built-In)</strong></h3>
<pre><code class="language-yaml">agents:
  - name: lead_scoring_agent
    type: ai_llm
    observes: ['contact.created']
    strategy: |
      Score leads 0-100 based on company size, industry fit, engagement
    audit: required
</code></pre>
<p><strong>Framework provides:</strong>
- ‚úÖ Agent sandbox (isolated execution)
- ‚úÖ LLM integration (OpenAI, Claude)
- ‚úÖ Permission system (can_execute: [...])
- ‚úÖ Audit trail (all actions logged)
- ‚úÖ Error handling (agent failures)</p>
<p><strong>Business specifies:</strong>
- üéØ When to trigger (observes)
- üéØ What to do (strategy)
- üéØ What's allowed (can_execute)</p>
<hr />
<h2 id="conclusion">‚úÖ Conclusion</h2>
<h3 id="key-insights"><strong>Key Insights</strong></h3>
<ol>
<li><strong>Framework handles 80% of code</strong> ‚Üí CRUD, permissions, events, audit, errors</li>
<li><strong>YAML focuses on 20% of logic</strong> ‚Üí Business validations, workflows, agents</li>
<li><strong>Result: 75-80% reduction in YAML verbosity</strong> ‚Üí Cleaner, more maintainable</li>
</ol>
<h3 id="revised-yaml-schema"><strong>Revised YAML Schema</strong></h3>
<pre><code class="language-yaml">entity: EntityName
  fields: {...}           # Simple type definitions
  actions:
    - name: action_name
      steps:
        - validate: business_rule
        - if: condition then: [workflow]
        - insert/update/delete: Entity(...)
        - call: function(...)
  agents:
    - name: agent_name
      strategy: |
        AI strategy description
</code></pre>
<p><strong>Total</strong>: 40-60 lines for complex entities (vs 200+ lines before)</p>
<h3 id="next-steps"><strong>Next Steps</strong></h3>
<ol>
<li>‚úÖ Build SpecQL compiler (Week 1-2)</li>
<li>‚úÖ Implement action step DSL (Week 3-4)</li>
<li>‚úÖ Add advanced patterns (Week 5-6)</li>
<li>‚úÖ Integrate AI agents (Week 7-8)</li>
<li>‚úÖ Production polish (Week 9-10)</li>
</ol>
<p><strong>Timeline</strong>: 10 weeks to production-ready SpecQL platform</p>
<p><strong>Result</strong>: Build SaaS backends in 1-2 weeks instead of 6-12 months (90% time reduction)</p>
<hr />
<p><strong>END OF REFINED ANALYSIS</strong></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
