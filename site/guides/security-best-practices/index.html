<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Security Best Practices - SpecQL Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Security Best Practices";
        var mkdocs_page_input_path = "guides/security-best-practices.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> SpecQL Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../getting-started/">Getting Started</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../mutation-patterns/">Mutation Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../test-generation/">Test Generation</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../cli/">CLI</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../reference/">Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../examples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../tutorials/">Tutorials</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../best-practices/">Best Practices</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">SpecQL Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Security Best Practices</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="security-best-practices">Security Best Practices</h1>
<p>This guide covers the security features and best practices for actions in the PrintOptim backend.</p>
<h2 id="multi-tenant-isolation">Multi-Tenant Isolation</h2>
<p>All data access is automatically isolated by tenant:</p>
<pre><code class="language-sql">-- Generated functions automatically include tenant filtering
SELECT * FROM crm.tb_contact
WHERE tenant_id = auth_tenant_id  -- Automatic
  AND id = input_data.contact_id
</code></pre>
<h3 id="trinity-pattern-security">Trinity Pattern Security</h3>
<p>The Trinity pattern ensures secure data access:</p>
<ul>
<li><strong>UUID external IDs</strong>: Public-facing identifiers</li>
<li><strong>INTEGER internal PKs</strong>: Database-optimized foreign keys</li>
<li><strong>Tenant isolation</strong>: All queries filtered by <code>tenant_id</code></li>
</ul>
<h2 id="sql-injection-protection">SQL Injection Protection</h2>
<h3 id="automatic-protection">Automatic Protection</h3>
<p>All generated SQL uses parameterized queries:</p>
<pre><code class="language-sql">-- âœ… Safe: Parameters are escaped
EXECUTE format('SELECT * FROM %I WHERE id = $1', table_name) USING entity_id;
</code></pre>
<h3 id="input-validation">Input Validation</h3>
<ul>
<li><strong>Type coercion</strong>: All inputs validated against schemas</li>
<li><strong>Enum validation</strong>: Only allowed values accepted</li>
<li><strong>Pattern matching</strong>: Email, phone, URL formats enforced</li>
</ul>
<h2 id="audit-logging">Audit Logging</h2>
<p>Every mutation is automatically logged:</p>
<pre><code class="language-sql">-- All changes recorded in app.tb_mutation_audit_log
INSERT INTO app.tb_mutation_audit_log (
    tenant_id, user_id, entity_type, entity_id,
    operation, status, updated_fields, message,
    object_data, extra_metadata, error_context
) VALUES (
    auth_tenant_id, auth_user_id, 'contact', contact_id,
    'UPDATE', 'success', ARRAY['status'], 'Contact updated',
    row_to_json(updated_contact), NULL, NULL
);
</code></pre>
<h3 id="audit-trail-features">Audit Trail Features</h3>
<ul>
<li><strong>Complete history</strong>: All changes tracked</li>
<li><strong>User attribution</strong>: Who made each change</li>
<li><strong>Timestamp tracking</strong>: When changes occurred</li>
<li><strong>Failure logging</strong>: Failed operations recorded</li>
<li><strong>Data snapshots</strong>: Before/after state preserved</li>
</ul>
<h2 id="authentication-authorization">Authentication &amp; Authorization</h2>
<h3 id="jwt-context">JWT Context</h3>
<p>All functions receive authenticated context:</p>
<pre><code class="language-sql">CREATE FUNCTION crm.create_contact(
    auth_tenant_id UUID,  -- From JWT
    auth_user_id UUID,    -- From JWT
    input_data app.type_create_contact_input,
    input_payload JSONB
) RETURNS app.mutation_result
</code></pre>
<h3 id="permission-checks">Permission Checks</h3>
<ul>
<li><strong>Tenant membership</strong>: Users can only access their organization's data</li>
<li><strong>Entity ownership</strong>: References validated for tenant ownership</li>
<li><strong>Field-level security</strong>: Sensitive fields protected</li>
</ul>
<h2 id="input-sanitization">Input Sanitization</h2>
<h3 id="composite-types">Composite Types</h3>
<p>Type-safe input using PostgreSQL composite types:</p>
<pre><code class="language-sql">-- Generated composite type
CREATE TYPE app.type_create_contact_input AS (
    email TEXT,
    status TEXT,
    company_id UUID
);

-- Function signature enforces structure
CREATE FUNCTION crm.create_contact(
    input_data app.type_create_contact_input  -- Type-safe
) RETURNS app.mutation_result
</code></pre>
<h3 id="jsonb-validation">JSONB Validation</h3>
<p>Additional validation on JSONB payloads:</p>
<ul>
<li><strong>Schema validation</strong>: Structure enforced</li>
<li><strong>Type checking</strong>: Data types validated</li>
<li><strong>Required fields</strong>: Mandatory fields checked</li>
</ul>
<h2 id="error-handling">Error Handling</h2>
<h3 id="structured-error-responses">Structured Error Responses</h3>
<p>Errors return actionable information:</p>
<pre><code class="language-json">{
  &quot;id&quot;: null,
  &quot;updated_fields&quot;: [&quot;email&quot;],
  &quot;status&quot;: &quot;failed:validation&quot;,
  &quot;message&quot;: &quot;Email is required&quot;,
  &quot;object_data&quot;: null,
  &quot;extra_metadata&quot;: {
    &quot;code&quot;: &quot;validation:required_field&quot;,
    &quot;user_action&quot;: &quot;Provide a value for email&quot;,
    &quot;field&quot;: &quot;email&quot;,
    &quot;entity&quot;: &quot;Contact&quot;
  }
}
</code></pre>
<h3 id="error-codes">Error Codes</h3>
<p>Standardized error codes for client handling:</p>
<ul>
<li><code>validation:*</code> - Input validation failures</li>
<li><code>constraint:*</code> - Database constraint violations</li>
<li><code>security:*</code> - Permission/security issues</li>
<li><code>reference:*</code> - Foreign key/reference errors</li>
</ul>
<h2 id="performance-security">Performance Security</h2>
<h3 id="query-optimization">Query Optimization</h3>
<p>Generated queries are optimized:</p>
<ul>
<li><strong>Indexes</strong>: Automatic index creation</li>
<li><strong>Trinity resolution</strong>: Efficient FK lookups</li>
<li><strong>Pagination</strong>: Built-in result limiting</li>
<li><strong>Timeout protection</strong>: Query timeouts enforced</li>
</ul>
<h3 id="resource-limits">Resource Limits</h3>
<ul>
<li><strong>Connection pooling</strong>: Database connections managed</li>
<li><strong>Query limits</strong>: Result set size restrictions</li>
<li><strong>Execution timeouts</strong>: Long-running query prevention</li>
</ul>
<h2 id="best-practices">Best Practices</h2>
<h3 id="writing-secure-actions">Writing Secure Actions</h3>
<ol>
<li>
<p><strong>Validate inputs early</strong>:
   ```yaml
   actions:</p>
<ul>
<li>name: create_contact
   steps:<ul>
<li>validate: email IS NOT NULL, error: missing_email</li>
<li>validate: email MATCHES email_pattern, error: invalid_email
   ```</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Use references for relationships</strong>:
   <code>yaml
   fields:
     company: ref(Company)  # Enforces tenant isolation</code></p>
</li>
<li>
<p><strong>Handle sensitive data appropriately</strong>:
   ```yaml
   # Audit logging captures all changes automatically</p>
</li>
<li>update: Contact SET status = 'qualified'  # Logged
   ```</li>
</ol>
<h3 id="monitoring-alerting">Monitoring &amp; Alerting</h3>
<ul>
<li><strong>Failed authentication attempts</strong>: Logged and monitored</li>
<li><strong>Unusual query patterns</strong>: Detected and alerted</li>
<li><strong>Audit log analysis</strong>: Security event detection</li>
<li><strong>Performance anomalies</strong>: Slow query alerting</li>
</ul>
<h2 id="compliance">Compliance</h2>
<h3 id="data-protection">Data Protection</h3>
<ul>
<li><strong>GDPR compliance</strong>: Right to erasure, data portability</li>
<li><strong>Audit trails</strong>: Complete change history</li>
<li><strong>Data retention</strong>: Configurable retention policies</li>
<li><strong>Access logging</strong>: All data access tracked</li>
</ul>
<h3 id="industry-standards">Industry Standards</h3>
<ul>
<li><strong>SOC 2</strong>: Security controls and monitoring</li>
<li><strong>ISO 27001</strong>: Information security management</li>
<li><strong>PCI DSS</strong>: Payment data protection (when applicable)</li>
</ul>
<h2 id="implementation-details">Implementation Details</h2>
<h3 id="security-headers">Security Headers</h3>
<p>All API responses include security headers:</p>
<ul>
<li><code>X-Tenant-ID</code>: Confirms tenant isolation</li>
<li><code>X-Request-ID</code>: Request tracing</li>
<li><code>X-Content-Type-Options: nosniff</code></li>
</ul>
<h3 id="encryption">Encryption</h3>
<ul>
<li><strong>Data at rest</strong>: Encrypted storage</li>
<li><strong>Data in transit</strong>: TLS 1.3 required</li>
<li><strong>Secrets management</strong>: Secure key storage</li>
</ul>
<h3 id="network-security">Network Security</h3>
<ul>
<li><strong>VPC isolation</strong>: Database in private network</li>
<li><strong>Firewall rules</strong>: Minimal required access</li>
<li><strong>DDoS protection</strong>: Rate limiting and filtering</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="common-security-issues">Common Security Issues</h3>
<ol>
<li><strong>Tenant data leakage</strong>:</li>
<li>Check tenant_id filters in queries</li>
<li>
<p>Verify FK resolution includes tenant context</p>
</li>
<li>
<p><strong>SQL injection attempts</strong>:</p>
</li>
<li>All queries use parameterized statements</li>
<li>
<p>Input validation prevents malicious data</p>
</li>
<li>
<p><strong>Unauthorized access</strong>:</p>
</li>
<li>JWT validation required for all requests</li>
<li>
<p>Tenant membership verified</p>
</li>
<li>
<p><strong>Audit gaps</strong>:</p>
</li>
<li>All mutations automatically logged</li>
<li>Custom actions include manual audit calls</li>
</ol>
<h2 id="contact">Contact</h2>
<p>For security concerns or questions:
- <strong>Security Team</strong>: security@printoptim.com
- <strong>DevOps</strong>: devops@printoptim.com
- <strong>CTO</strong>: cto@printoptim.com</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
