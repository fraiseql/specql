<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>FINAL SpecQL Completion Plan - FraiseQL YAML Format - SpecQL Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "FINAL SpecQL Completion Plan - FraiseQL YAML Format";
        var mkdocs_page_input_path = "implementation-plans/FINAL_COMPLETION_PLAN.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> SpecQL Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../getting-started/">Getting Started</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../guides/mutation-patterns/">Mutation Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../guides/test-generation/">Test Generation</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../guides/cli/">CLI</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../reference/">Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../examples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../tutorials/">Tutorials</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../best-practices/">Best Practices</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">SpecQL Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">FINAL SpecQL Completion Plan - FraiseQL YAML Format</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="final-specql-completion-plan-fraiseql-yaml-format">FINAL SpecQL Completion Plan - FraiseQL YAML Format</h1>
<p><strong>Date</strong>: 2025-11-08
<strong>Based On</strong>: FraiseQL Comment Format Guide (YAML-based)
<strong>Timeline</strong>: 1.5-2 weeks (8-10 days)
<strong>Current Completion</strong>: 80-85%</p>
<hr />
<h2 id="critical-discovery">üéØ Critical Discovery</h2>
<p><strong>We're using the OLD format:</strong></p>
<pre><code class="language-sql">COMMENT ON TYPE app.mutation_result IS
  '@fraiseql:type name=MutationResult';
</code></pre>
<p><strong>FraiseQL expects NEW format (YAML with description):</strong></p>
<pre><code class="language-sql">COMMENT ON TYPE app.mutation_result IS
'Standard mutation result for all operations.

@fraiseql:composite
name: MutationResult
tier: 1';
</code></pre>
<p><strong>Impact</strong>: Need to update ALL comment generation to match FraiseQL's YAML format</p>
<hr />
<h2 id="what-needs-to-change">üìã What Needs to Change</h2>
<h3 id="current-state-vs-required-state">Current State vs Required State</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Current Format</th>
<th>Required Format</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Composite types</td>
<td>Old <code>@fraiseql:type name=X</code></td>
<td>YAML <code>@fraiseql:composite</code> + description</td>
<td>‚ùå Needs update</td>
</tr>
<tr>
<td>Composite fields</td>
<td>Old <code>name=x,type=Y</code></td>
<td>YAML multi-line</td>
<td>‚ùå Needs update</td>
</tr>
<tr>
<td>Functions</td>
<td>Old single-line</td>
<td>YAML multi-line</td>
<td>‚ùå Needs update</td>
</tr>
<tr>
<td>Tables</td>
<td>No comments</td>
<td>Need <code>@fraiseql:type</code></td>
<td>‚ùå Missing</td>
</tr>
<tr>
<td>Columns</td>
<td>Basic descriptions</td>
<td>Need <code>@fraiseql:field</code></td>
<td>‚ùå Missing</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="revised-8-10-day-plan">üöÄ REVISED 8-10 DAY PLAN</h2>
<h3 id="week-1-days-1-5-update-comment-format-to-fraiseql-yaml-spec">Week 1 (Days 1-5): Update Comment Format to FraiseQL YAML Spec</h3>
<h3 id="week-2-days-6-810-custom-actions-cli-docs">Week 2 (Days 6-8/10): Custom Actions + CLI + Docs</h3>
<hr />
<h1 id="week-1-fraiseql-yaml-format-migration">WEEK 1: FraiseQL YAML Format Migration</h1>
<h2 id="day-1-composite-type-comments">Day 1: Composite Type Comments</h2>
<p><strong>Objective</strong>: Update all composite type comments to YAML format</p>
<h3 id="tdd-cycle-1-mutation-result-type-2-hours">TDD Cycle 1: Mutation Result Type (2 hours)</h3>
<p><strong>üî¥ RED</strong> (30 min)</p>
<pre><code class="language-python"># tests/unit/generators/test_app_schema_generator.py
def test_mutation_result_comment_yaml_format():
    &quot;&quot;&quot;Mutation result should use YAML format with description&quot;&quot;&quot;
    generator = AppSchemaGenerator()
    sql = generator.generate_mutation_result_type()

    # Should have human-readable description
    assert &quot;'Standard mutation result&quot; in sql

    # Should have YAML metadata after blank line
    assert &quot;@fraiseql:composite&quot; in sql
    assert &quot;name: MutationResult&quot; in sql
    assert &quot;tier: 1&quot; in sql

    # Full format check
    expected_comment = &quot;&quot;&quot;COMMENT ON TYPE app.mutation_result IS
'Standard mutation result for all operations.
Returns entity data, status, and optional metadata.

@fraiseql:composite
name: MutationResult
tier: 1
storage: composite';&quot;&quot;&quot;
    assert expected_comment in sql
</code></pre>
<p>Run: <code>uv run pytest tests/unit/generators/test_app_schema_generator.py::test_mutation_result_comment_yaml_format -v</code>
Expected: <strong>FAIL</strong></p>
<p><strong>üü¢ GREEN</strong> (1 hour)
1. Update <code>src/generators/app_schema_generator.py</code>
2. Change comment generation to YAML format
3. Add description text before metadata</p>
<pre><code class="language-python">def _generate_mutation_result_comment(self) -&gt; str:
    &quot;&quot;&quot;Generate FraiseQL-compatible YAML comment&quot;&quot;&quot;
    return &quot;&quot;&quot;COMMENT ON TYPE app.mutation_result IS
'Standard mutation result for all operations.
Returns entity data, status, and optional metadata.

@fraiseql:composite
name: MutationResult
tier: 1
storage: composite';&quot;&quot;&quot;
</code></pre>
<p><strong>üîß REFACTOR</strong> (20 min)
Extract to template</p>
<p><strong>‚úÖ QA</strong> (10 min)
Test suite</p>
<hr />
<h3 id="tdd-cycle-2-composite-type-field-comments-2-hours">TDD Cycle 2: Composite Type Field Comments (2 hours)</h3>
<p><strong>üî¥ RED</strong> (30 min)</p>
<pre><code class="language-python">def test_mutation_result_field_comments_yaml_format():
    &quot;&quot;&quot;Field comments should use YAML format&quot;&quot;&quot;
    generator = AppSchemaGenerator()
    sql = generator.generate_mutation_result_type()

    # Check id field comment
    expected_id_comment = &quot;&quot;&quot;COMMENT ON COLUMN app.mutation_result.id IS
'Unique identifier of the affected entity.

@fraiseql:field
name: id
type: UUID!
required: true';&quot;&quot;&quot;
    assert expected_id_comment in sql

    # Check status field comment
    expected_status_comment = &quot;&quot;&quot;COMMENT ON COLUMN app.mutation_result.status IS
'Operation status indicator.
Values: success, failed:error_code

@fraiseql:field
name: status
type: String!
required: true';&quot;&quot;&quot;
    assert expected_status_comment in sql
</code></pre>
<p><strong>üü¢ GREEN</strong> (1 hour)
Update field comment generation</p>
<p><strong>üîß REFACTOR</strong> (20 min)
Template optimization</p>
<p><strong>‚úÖ QA</strong> (10 min)
Test</p>
<hr />
<h3 id="tdd-cycle-3-generated-composite-types-3-hours">TDD Cycle 3: Generated Composite Types (3 hours)</h3>
<p><strong>üî¥ RED</strong> (45 min)</p>
<pre><code class="language-python"># tests/unit/generators/test_composite_type_generator.py
def test_generate_input_composite_with_yaml_comments():
    &quot;&quot;&quot;Generated input composites should have YAML comments&quot;&quot;&quot;
    entity = Entity(name=&quot;Contact&quot;, schema=&quot;crm&quot;)
    action = Action(name=&quot;create_contact&quot;, ...)

    generator = CompositeTypeGenerator()
    sql = generator.generate_input_composite(entity, action)

    # Should have type-level comment
    expected_type_comment = &quot;&quot;&quot;COMMENT ON TYPE app.type_create_contact_input IS
'Input parameters for creating Contact.

@fraiseql:composite
name: CreateContactInput
tier: 2';&quot;&quot;&quot;
    assert expected_type_comment in sql

    # Should have field-level comments
    expected_field_comment = &quot;&quot;&quot;COMMENT ON COLUMN app.type_create_contact_input.email IS
'Email address (required).

@fraiseql:field
name: email
type: Email!
required: true';&quot;&quot;&quot;
    assert expected_field_comment in sql
</code></pre>
<p><strong>üü¢ GREEN</strong> (1.5 hours)
Update <code>CompositeTypeGenerator</code> to use YAML format</p>
<p><strong>üîß REFACTOR</strong> (45 min)
Clean up, add helpers for YAML generation</p>
<p><strong>‚úÖ QA</strong> (30 min)
Full test suite</p>
<p><strong>END OF DAY 1</strong>: Composite type comments migrated to YAML</p>
<hr />
<h2 id="day-2-function-comments">Day 2: Function Comments</h2>
<p><strong>Objective</strong>: Update function comments to YAML format</p>
<h3 id="tdd-cycle-1-app-wrapper-function-comments-3-hours">TDD Cycle 1: App Wrapper Function Comments (3 hours)</h3>
<p><strong>üî¥ RED</strong> (45 min)</p>
<pre><code class="language-python"># tests/unit/generators/test_app_wrapper_generator.py
def test_app_wrapper_comment_yaml_format():
    &quot;&quot;&quot;App wrapper function should have YAML comment&quot;&quot;&quot;
    entity = Entity(name=&quot;Contact&quot;, schema=&quot;crm&quot;)
    action = Action(name=&quot;create_contact&quot;, ...)

    generator = AppWrapperGenerator()
    sql = generator.generate(entity, action)

    expected_comment = &quot;&quot;&quot;COMMENT ON FUNCTION app.create_contact IS
'Creates a new contact record.
Validates input and delegates to core business logic.

@fraiseql:mutation
name: createContact
input_type: app.type_create_contact_input
success_type: CreateContactSuccess
failure_type: CreateContactError';&quot;&quot;&quot;

    assert expected_comment in sql
</code></pre>
<p><strong>üü¢ GREEN</strong> (1.5 hours)
Update <code>AppWrapperGenerator</code> and template</p>
<p><strong>üîß REFACTOR</strong> (45 min)
Clean up template</p>
<p><strong>‚úÖ QA</strong> (30 min)
Test suite</p>
<hr />
<h3 id="tdd-cycle-2-generate-action-descriptions-2-hours">TDD Cycle 2: Generate Action Descriptions (2 hours)</h3>
<p><strong>üî¥ RED</strong> (30 min)</p>
<pre><code class="language-python">def test_generate_action_description_from_steps():
    &quot;&quot;&quot;Should generate description from action steps&quot;&quot;&quot;
    action = Action(
        name=&quot;qualify_lead&quot;,
        steps=[
            ActionStep(type=&quot;validate&quot;, expression=&quot;status = 'lead'&quot;),
            ActionStep(type=&quot;update&quot;, entity=&quot;Contact&quot;, fields={&quot;status&quot;: &quot;qualified&quot;})
        ]
    )

    generator = AppWrapperGenerator()
    description = generator._generate_action_description(action)

    # Should describe what action does
    assert &quot;Qualifies a lead&quot; in description or &quot;Updates lead status&quot; in description
</code></pre>
<p><strong>üü¢ GREEN</strong> (1 hour)
Implement description generation logic</p>
<p><strong>üîß REFACTOR</strong> (20 min)
Improve heuristics</p>
<p><strong>‚úÖ QA</strong> (10 min)
Test</p>
<p><strong>END OF DAY 2</strong>: Function comments migrated to YAML</p>
<hr />
<h2 id="day-3-table-and-column-comments">Day 3: Table and Column Comments</h2>
<p><strong>Objective</strong>: Add FraiseQL annotations to tables and columns</p>
<h3 id="tdd-cycle-1-table-comments-with-fraiseqltype-2-hours">TDD Cycle 1: Table Comments with @fraiseql:type (2 hours)</h3>
<p><strong>üî¥ RED</strong> (30 min)</p>
<pre><code class="language-python"># tests/unit/generators/test_table_generator.py
def test_table_comment_with_fraiseql_type():
    &quot;&quot;&quot;Tables should have @fraiseql:type annotation&quot;&quot;&quot;
    entity = Entity(
        name=&quot;Contact&quot;,
        schema=&quot;crm&quot;,
        description=&quot;Customer contact record&quot;
    )

    generator = TableGenerator()
    sql = generator.generate_table(entity)

    expected_comment = &quot;&quot;&quot;COMMENT ON TABLE crm.tb_contact IS
'Customer contact record.
Stores contact information with email, phone, and company relationships.

@fraiseql:type
trinity: true';&quot;&quot;&quot;

    assert expected_comment in sql
</code></pre>
<p><strong>üü¢ GREEN</strong> (1 hour)
Update <code>TableGenerator</code> to add FraiseQL type comments</p>
<p><strong>üîß REFACTOR</strong> (20 min)
Clean up</p>
<p><strong>‚úÖ QA</strong> (10 min)
Test</p>
<hr />
<h3 id="tdd-cycle-2-column-comments-with-fraiseqlfield-3-hours">TDD Cycle 2: Column Comments with @fraiseql:field (3 hours)</h3>
<p><strong>üî¥ RED</strong> (45 min)</p>
<pre><code class="language-python">def test_column_comments_with_fraiseql_field():
    &quot;&quot;&quot;Columns should have @fraiseql:field annotations&quot;&quot;&quot;
    entity = Entity(name=&quot;Contact&quot;, schema=&quot;crm&quot;, fields={
        &quot;email&quot;: FieldDefinition(
            name=&quot;email&quot;,
            type_name=&quot;email&quot;,
            nullable=False,
            fraiseql_type=&quot;Email&quot;
        )
    })

    generator = TableGenerator()
    sql = generator.generate_table(entity)

    expected_comment = &quot;&quot;&quot;COMMENT ON COLUMN crm.tb_contact.email IS
'Email address (validated format).

@fraiseql:field
name: email
type: Email!
required: true';&quot;&quot;&quot;

    assert expected_comment in sql
</code></pre>
<p><strong>üü¢ GREEN</strong> (1.5 hours)
Implement column comment generation with YAML</p>
<p><strong>üîß REFACTOR</strong> (45 min)
Template optimization</p>
<p><strong>‚úÖ QA</strong> (30 min)
Test suite</p>
<hr />
<h3 id="tdd-cycle-3-trinity-helper-functions-1-hour">TDD Cycle 3: Trinity Helper Functions (1 hour)</h3>
<p><strong>üî¥ RED</strong> (20 min)</p>
<pre><code class="language-python">def test_trinity_helper_comments():
    &quot;&quot;&quot;Trinity helper functions should have descriptions&quot;&quot;&quot;
    entity = Entity(name=&quot;Contact&quot;, schema=&quot;crm&quot;)

    generator = TrinityHelperGenerator()
    sql = generator.generate_helpers(entity)

    expected_comment = &quot;&quot;&quot;COMMENT ON FUNCTION crm.contact_pk(TEXT, UUID) IS
'Trinity Pattern: Resolve entity identifier to internal INTEGER primary key.
Accepts UUID, text identifier, or integer pk and returns pk_contact.';&quot;&quot;&quot;

    assert expected_comment in sql
</code></pre>
<p><strong>üü¢ GREEN</strong> (30 min)
Add comments to Trinity helpers</p>
<p><strong>üîß REFACTOR</strong> (5 min)
Clean up</p>
<p><strong>‚úÖ QA</strong> (5 min)
Test</p>
<p><strong>END OF DAY 3</strong>: All table/column comments have FraiseQL annotations</p>
<hr />
<h2 id="day-4-integration-testing">Day 4: Integration Testing</h2>
<p><strong>Objective</strong>: Verify complete pipeline generates correct YAML comments</p>
<h3 id="tdd-cycle-1-end-to-end-comment-format-test-3-hours">TDD Cycle 1: End-to-End Comment Format Test (3 hours)</h3>
<p><strong>üî¥ RED</strong> (1 hour)</p>
<pre><code class="language-python"># tests/integration/test_fraiseql_yaml_format.py
def test_complete_pipeline_generates_yaml_comments():
    &quot;&quot;&quot;Complete SpecQL ‚Üí SQL pipeline should generate YAML-formatted comments&quot;&quot;&quot;
    yaml_content = &quot;&quot;&quot;
    entity: Contact
    schema: crm
    description: Customer contact information
    fields:
      email: email!
      company: ref(Company)
      status: enum(lead, qualified)
    actions:
      - name: create_contact
        steps:
          - validate: email IS NOT NULL
          - insert: Contact
      - name: qualify_lead
        steps:
          - validate: status = 'lead'
          - update: Contact SET status = 'qualified'
    &quot;&quot;&quot;

    # Parse
    parser = SpecQLParser()
    entity = parser.parse(yaml_content)

    # Generate
    orchestrator = SchemaOrchestrator()
    sql = orchestrator.generate_complete_schema(entity)

    # Verify YAML format in comments

    # 1. Table comment
    assert &quot;COMMENT ON TABLE crm.tb_contact IS&quot; in sql
    assert &quot;@fraiseql:type&quot; in sql
    assert &quot;trinity: true&quot; in sql

    # 2. Column comments
    assert &quot;COMMENT ON COLUMN crm.tb_contact.email IS&quot; in sql
    assert &quot;@fraiseql:field&quot; in sql
    assert &quot;name: email&quot; in sql  # YAML format
    assert &quot;type: Email!&quot; in sql
    assert &quot;required: true&quot; in sql

    # 3. Composite type comments
    assert &quot;COMMENT ON TYPE app.type_create_contact_input IS&quot; in sql
    assert &quot;@fraiseql:composite&quot; in sql
    assert &quot;name: CreateContactInput&quot; in sql
    assert &quot;tier: 2&quot; in sql

    # 4. Function comments
    assert &quot;COMMENT ON FUNCTION app.create_contact IS&quot; in sql
    assert &quot;@fraiseql:mutation&quot; in sql
    assert &quot;name: createContact&quot; in sql
    assert &quot;input_type: app.type_create_contact_input&quot; in sql

    # Verify NO old format remains
    assert &quot;@fraiseql:type name=&quot; not in sql  # Old format
    assert &quot;@fraiseql:field name=email,type=&quot; not in sql  # Old format
</code></pre>
<p><strong>üü¢ GREEN</strong> (1.5 hours)
Fix any integration issues found</p>
<p><strong>üîß REFACTOR</strong> (30 min)
Polish</p>
<p><strong>‚úÖ QA</strong> (30 min)
Run multiple times</p>
<hr />
<h3 id="task-2-fraiseql-format-documentation-2-hours">Task 2: FraiseQL Format Documentation (2 hours)</h3>
<p><strong>Non-TDD</strong>: Document our implementation</p>
<p>Create <code>docs/architecture/FRAISEQL_COMMENT_IMPLEMENTATION.md</code>:</p>
<pre><code class="language-markdown"># FraiseQL Comment Implementation in SpecQL

This documents how SpecQL generates PostgreSQL comments compatible with FraiseQL's YAML format.

## Format Overview

All comments follow this structure:

</code></pre>
<p>[Human-readable description]</p>
<p>@fraiseql:[type]
[YAML configuration]</p>
<pre><code>
## Implementation

### Composite Types

Generator: `CompositeTypeGenerator`
Template: `templates/sql/composite_type_comments.sql.j2`

Example output:
```sql
COMMENT ON TYPE app.type_simple_address IS
'Simple postal address without validation.

@fraiseql:composite
name: SimpleAddress
tier: 2
storage: jsonb';
</code></pre>
<h3 id="fields">Fields</h3>
<p>Generator: <code>CompositeTypeGenerator</code>
Template: <code>templates/sql/field_comments.sql.j2</code></p>
<p>Example output:</p>
<pre><code class="language-sql">COMMENT ON COLUMN app.type_simple_address.street IS
'Street address line 1 (required).

@fraiseql:field
name: street
type: String!
required: true';
</code></pre>
<p>... (continue for all comment types)</p>
<pre><code>
**END OF DAY 4**: Integration complete, documented

---

## Day 5: Buffer / Polish

**Objective**: Clean up and prepare for custom actions

### Morning (4 hours): Code Review
- Review all comment generation code
- Ensure consistency across generators
- Fix any edge cases
- Add missing validations

### Afternoon (4 hours): Testing
- Run full test suite 10x
- Fix flaky tests
- Manual inspection of generated SQL
- Verify FraiseQL can parse all comments (if possible)

**END OF WEEK 1**: All comments migrated to FraiseQL YAML format

---

# WEEK 2: Custom Actions + CLI + Ship

## Day 6: Custom Actions

**Objective**: Support non-CRUD custom actions

### TDD Cycle 1: Custom Action Detection &amp; Generation (4 hours)

**üî¥ RED** (45 min)
```python
# tests/unit/generators/test_core_logic_generator.py
def test_generate_custom_action():
    &quot;&quot;&quot;Generate custom business action&quot;&quot;&quot;
    entity = Entity(name=&quot;Contact&quot;, schema=&quot;crm&quot;)
    action = Action(
        name=&quot;qualify_lead&quot;,
        steps=[
            ActionStep(type=&quot;validate&quot;, expression=&quot;status = 'lead'&quot;),
            ActionStep(type=&quot;update&quot;, entity=&quot;Contact&quot;, fields={&quot;status&quot;: &quot;qualified&quot;}),
            ActionStep(type=&quot;notify&quot;, template=&quot;lead_qualified&quot;)
        ]
    )

    generator = CoreLogicGenerator()
    sql = generator.generate_custom_action(entity, action)

    # Should have function
    assert &quot;CREATE FUNCTION crm.qualify_lead(&quot; in sql

    # Should compile steps
    assert &quot;status = 'lead'&quot; in sql  # validate
    assert &quot;UPDATE crm.tb_contact&quot; in sql  # update
    assert &quot;PERFORM app.emit_event&quot; in sql  # notify

    # Should have YAML comment
    assert &quot;@fraiseql:mutation&quot; in sql
    assert &quot;name: qualifyLead&quot; in sql
</code></pre>
<p><strong>üü¢ GREEN</strong> (2.5 hours)
Implement custom action generation</p>
<p><strong>üîß REFACTOR</strong> (45 min)
Clean up</p>
<p><strong>‚úÖ QA</strong> (30 min)
Test suite</p>
<hr />
<h3 id="tdd-cycle-2-database-roundtrip-2-hours">TDD Cycle 2: Database Roundtrip (2 hours)</h3>
<p><strong>üî¥ RED</strong> (30 min)</p>
<pre><code class="language-python">def test_custom_action_database_execution(test_db):
    &quot;&quot;&quot;Custom action executes in PostgreSQL&quot;&quot;&quot;
    # (Similar to previous plan)
</code></pre>
<p><strong>üü¢ GREEN</strong> (1 hour)
Fix execution issues</p>
<p><strong>üîß REFACTOR</strong> (20 min)
Polish</p>
<p><strong>‚úÖ QA</strong> (10 min)
Test</p>
<p><strong>END OF DAY 6</strong>: Custom actions complete</p>
<hr />
<h2 id="day-7-cli-generate-command">Day 7: CLI Generate Command</h2>
<p><strong>Objective</strong>: Production CLI</p>
<h3 id="tdd-cycle-1-basic-generate-3-hours">TDD Cycle 1: Basic Generate (3 hours)</h3>
<p><strong>üî¥ RED</strong> (45 min)</p>
<pre><code class="language-python">def test_cli_generate_command():
    &quot;&quot;&quot;CLI should generate migrations&quot;&quot;&quot;
    result = cli_runner.invoke(generate_command, [&quot;entities/contact.yaml&quot;])

    assert result.exit_code == 0
    assert &quot;‚úì Generated: migrations/001_contact.sql&quot; in result.output
</code></pre>
<p><strong>üü¢ GREEN</strong> (1.5 hours)
Implement CLI</p>
<p><strong>üîß REFACTOR</strong> (45 min)
Polish output</p>
<p><strong>‚úÖ QA</strong> (30 min)
Test</p>
<hr />
<h3 id="tdd-cycle-2-validate-command-2-hours">TDD Cycle 2: Validate Command (2 hours)</h3>
<p><strong>üî¥ RED</strong> (30 min)</p>
<pre><code class="language-python">def test_cli_validate_command():
    &quot;&quot;&quot;Validate SpecQL files&quot;&quot;&quot;
    result = cli_runner.invoke(validate_command, [&quot;entities/contact.yaml&quot;])

    assert result.exit_code == 0
    assert &quot;‚úì contact.yaml is valid&quot; in result.output
</code></pre>
<p><strong>üü¢ GREEN</strong> (1 hour)
Implement validation</p>
<p><strong>üîß REFACTOR</strong> (20 min)
Error messages</p>
<p><strong>‚úÖ QA</strong> (10 min)
Test</p>
<p><strong>END OF DAY 7</strong>: CLI complete</p>
<hr />
<h2 id="day-8-documentation-examples">Day 8: Documentation + Examples</h2>
<h3 id="morning-4-hours-user-docs">Morning (4 hours): User Docs</h3>
<p>Write:
1. <strong>Getting Started</strong> (<code>docs/guides/getting-started.md</code>)
2. <strong>SpecQL Reference</strong> (<code>docs/reference/specql-syntax.md</code>)
3. <strong>FraiseQL Integration</strong> (<code>docs/guides/fraiseql-integration.md</code>)</p>
<h3 id="afternoon-4-hours-examples">Afternoon (4 hours): Examples</h3>
<p>Create:
1. <strong>CRM Example</strong> (<code>examples/crm/</code>)
2. <strong>E-commerce Example</strong> (<code>examples/ecommerce/</code>)</p>
<p><strong>END OF DAY 8</strong>: Documentation complete</p>
<hr />
<h2 id="day-9-10-polish-release">Day 9-10: Polish &amp; Release</h2>
<h3 id="day-9-final-polish">Day 9: Final Polish</h3>
<ul>
<li>Fix TODOs</li>
<li>Improve error messages</li>
<li>Code review</li>
<li>Testing marathon</li>
</ul>
<h3 id="day-10-release">Day 10: Release</h3>
<ul>
<li>Version 1.0.0</li>
<li>CHANGELOG.md</li>
<li>Release notes</li>
<li>Demo</li>
</ul>
<p><strong>END OF DAY 10</strong>: Ready to ship!</p>
<hr />
<h2 id="success-criteria">üéØ SUCCESS CRITERIA</h2>
<h3 id="functionality">Functionality ‚úÖ</h3>
<ul>
<li>[ ] All comments use YAML format (FraiseQL compatible)</li>
<li>[ ] Composite types have proper annotations</li>
<li>[ ] Functions have proper annotations</li>
<li>[ ] Tables/columns have proper annotations</li>
<li>[ ] Custom actions work</li>
<li>[ ] CLI commands work</li>
<li>[ ] 330+ tests passing</li>
</ul>
<h3 id="quality">Quality ‚úÖ</h3>
<ul>
<li>[ ] No critical bugs</li>
<li>[ ] Performance acceptable</li>
<li>[ ] Error messages helpful</li>
<li>[ ] Documentation complete</li>
<li>[ ] Examples working</li>
</ul>
<h3 id="deliverables">Deliverables ‚úÖ</h3>
<ul>
<li>[ ] YAML-formatted comments throughout</li>
<li>[ ] Custom action support</li>
<li>[ ] CLI tools</li>
<li>[ ] User documentation</li>
<li>[ ] Working examples</li>
<li>[ ] FraiseQL can introspect generated schema</li>
</ul>
<hr />
<h2 id="comment-format-checklist">üìä Comment Format Checklist</h2>
<p>Before shipping, verify all comments match FraiseQL format:</p>
<h3 id="composite-types">Composite Types ‚úÖ</h3>
<pre><code class="language-sql">COMMENT ON TYPE schema.type_name IS
'[Description]

@fraiseql:composite
name: GraphQLName
tier: 1|2|3';
</code></pre>
<h3 id="composite-fields">Composite Fields ‚úÖ</h3>
<pre><code class="language-sql">COMMENT ON COLUMN schema.type_name.field IS
'[Description]

@fraiseql:field
name: fieldName
type: GraphQLType
required: true|false';
</code></pre>
<h3 id="functions">Functions ‚úÖ</h3>
<pre><code class="language-sql">COMMENT ON FUNCTION schema.func IS
'[Description]

@fraiseql:mutation
name: mutationName
input_type: schema.type_input
success_type: SuccessType
failure_type: FailureType';
</code></pre>
<h3 id="tables">Tables ‚úÖ</h3>
<pre><code class="language-sql">COMMENT ON TABLE schema.tb_entity IS
'[Description]

@fraiseql:type
trinity: true';
</code></pre>
<h3 id="columns">Columns ‚úÖ</h3>
<pre><code class="language-sql">COMMENT ON COLUMN schema.tb_entity.field IS
'[Description]

@fraiseql:field
name: fieldName
type: GraphQLType
required: true|false';
</code></pre>
<hr />
<h2 id="daily-progress-template">üìà Daily Progress Template</h2>
<pre><code class="language-markdown">### Day 1 (YYYY-MM-DD) - Composite Type Comments
- [ ] Cycle 1: mutation_result YAML format
- [ ] Cycle 2: Field comments YAML format
- [ ] Cycle 3: Generated composites YAML format
- Tests: ___/330 passing
- Blockers: ___
- Notes: ___

... (continue for all days)
</code></pre>
<hr />
<h2 id="critical-differences-from-previous-plans">üöÄ CRITICAL DIFFERENCES FROM PREVIOUS PLANS</h2>
<h3 id="what-changed">What Changed:</h3>
<ol>
<li><strong>Comment Format</strong>: YAML with description (not single-line)</li>
<li><strong>Annotation Names</strong>: <code>@fraiseql:composite</code> (not <code>@fraiseql:type</code>)</li>
<li><strong>Field Format</strong>: Multi-line YAML (not <code>name=x,type=y</code>)</li>
<li><strong>Required Fields</strong>: Must include description text before metadata</li>
</ol>
<h3 id="what-stayed-same">What Stayed Same:</h3>
<ol>
<li>Custom actions still needed</li>
<li>CLI still needed</li>
<li>Documentation still needed</li>
<li>Testing approach (TDD cycles)</li>
</ol>
<hr />
<p><strong>Timeline</strong>: 8-10 days (1.5-2 weeks)
<strong>Risk</strong>: LOW (format migration is straightforward)
<strong>Confidence</strong>: HIGH (clear spec from FraiseQL team)
<strong>Next Action</strong>: Start Day 1, Cycle 1 - Update mutation_result comment</p>
<hr />
<p><strong>READY TO BEGIN?</strong></p>
<p>This plan migrates all our comment generation to match FraiseQL's exact YAML format specification, then completes the remaining features (custom actions, CLI, docs).</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
