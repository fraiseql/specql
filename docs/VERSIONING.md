# SpecQL Versioning & Release Process

**Version Management**: Semantic Versioning (SemVer)
**Current Version**: 0.1.0

---

## üìã Semantic Versioning

SpecQL follows [Semantic Versioning 2.0.0](https://semver.org/):

```
MAJOR.MINOR.PATCH
```

- **MAJOR**: Breaking changes (incompatible API changes)
- **MINOR**: New features (backward-compatible)
- **PATCH**: Bug fixes (backward-compatible)

### Version Increment Guidelines

| Change Type | Version Bump | Example |
|-------------|--------------|---------|
| Breaking change to YAML schema | MAJOR | 1.0.0 ‚Üí 2.0.0 |
| Breaking change to generated SQL | MAJOR | 1.0.0 ‚Üí 2.0.0 |
| New SpecQL field type | MINOR | 1.0.0 ‚Üí 1.1.0 |
| New action step type | MINOR | 1.0.0 ‚Üí 1.1.0 |
| Bug fix in code generation | PATCH | 1.0.0 ‚Üí 1.0.1 |
| Documentation update | None | No version change |

---

## üõ†Ô∏è Version Management Commands

### Check Current Version

```bash
python scripts/version.py
# Output: Current version: 0.1.0
```

### Bump Version

```bash
# Patch: 0.1.0 ‚Üí 0.1.1 (bug fixes)
python scripts/version.py bump patch

# Minor: 0.1.0 ‚Üí 0.2.0 (new features)
python scripts/version.py bump minor

# Major: 0.1.0 ‚Üí 1.0.0 (breaking changes)
python scripts/version.py bump major
```

### Set Specific Version

```bash
python scripts/version.py set 1.2.3
```

**Note**: The script automatically updates both `VERSION` file and `pyproject.toml`.

---

## üöÄ Release Process

### 1. Prepare Release

```bash
# 1. Ensure you're on main branch with latest changes
git checkout main
git pull origin main

# 2. Run full test suite
uv run pytest

# 3. Update version
python scripts/version.py bump [major|minor|patch]

# 4. Update CHANGELOG.md
# - Move items from [Unreleased] to new version section
# - Add release date
# - Update comparison links at bottom
```

### 2. Update CHANGELOG.md

Example:

```markdown
## [Unreleased]

## [0.2.0] - 2025-11-15

### Added
- New `datetime` field type
- Support for composite foreign keys

### Fixed
- Trinity helper function generation bug

[unreleased]: https://github.com/fraiseql/specql/compare/v0.2.0...HEAD
[0.2.0]: https://github.com/fraiseql/specql/compare/v0.1.0...v0.2.0
```

### 3. Commit and Tag

```bash
# Commit version bump
git add VERSION pyproject.toml CHANGELOG.md
git commit -m "chore: Bump version to $(cat VERSION)

- Update VERSION and pyproject.toml
- Update CHANGELOG.md with release notes"

# Create git tag
VERSION=$(cat VERSION)
git tag -a "v$VERSION" -m "Release v$VERSION"

# Push changes and tag
git push origin main
git push origin "v$VERSION"
```

### 4. Automated Release

Once the tag is pushed, GitHub Actions will automatically:

1. ‚úÖ Run full test suite
2. ‚úÖ Verify version consistency (VERSION file vs tag)
3. ‚úÖ Extract changelog for this version
4. ‚úÖ Create GitHub Release with notes
5. ‚úÖ Build distribution packages
6. ‚úÖ Upload artifacts

**Release URL**: `https://github.com/fraiseql/specql/releases/tag/v{VERSION}`

---

## üîç Version Consistency Checks

### Pull Request Checks

When you create a PR to `main`, GitHub Actions automatically:

1. **Check if VERSION changed**
   - If changed: Validates version format and increment
   - If not changed: Passes (for docs/test-only changes)

2. **Validate version format**
   - Must be `MAJOR.MINOR.PATCH` (e.g., `1.2.3`)
   - No pre-release identifiers in main branch

3. **Check version increment**
   - Prevents version downgrades
   - Ensures version increments properly

4. **Verify file sync**
   - VERSION file must match pyproject.toml
   - Use `python scripts/version.py` to avoid manual errors

### Local Validation

```bash
# Check version format
cat VERSION | grep -Pq '^\d+\.\d+\.\d+$' && echo "‚úÖ Valid" || echo "‚ùå Invalid"

# Verify VERSION and pyproject.toml sync
VERSION=$(cat VERSION)
PYPROJECT_VERSION=$(grep '^version = ' pyproject.toml | cut -d'"' -f2)
[ "$VERSION" = "$PYPROJECT_VERSION" ] && echo "‚úÖ Synced" || echo "‚ùå Out of sync"
```

---

## üì¶ Release Artifacts

Each release includes:

1. **Source Code Archive** (auto-generated by GitHub)
   - `.zip` and `.tar.gz` formats

2. **Python Distribution Packages**
   - Wheel (`.whl`) for installation
   - Source distribution (`.tar.gz`)

3. **Release Notes**
   - Extracted from CHANGELOG.md
   - Auto-generated from commits

---

## üéØ Best Practices

### Before Releasing

- ‚úÖ Run full test suite: `uv run pytest`
- ‚úÖ Update CHANGELOG.md with all changes
- ‚úÖ Review breaking changes (require MAJOR bump)
- ‚úÖ Test version bump script: `python scripts/version.py`

### During Development

- üìù Keep CHANGELOG.md updated in `[Unreleased]` section
- üè∑Ô∏è Use conventional commit messages
- üß™ Add tests for new features
- üìö Update documentation

### Version Bump Guidelines

```bash
# Bug fixes only ‚Üí PATCH
python scripts/version.py bump patch

# New features, backward-compatible ‚Üí MINOR
python scripts/version.py bump minor

# Breaking changes ‚Üí MAJOR
python scripts/version.py bump major
```

---

## üîó Quick Reference

| Task | Command |
|------|---------|
| Check version | `python scripts/version.py` |
| Bump patch | `python scripts/version.py bump patch` |
| Bump minor | `python scripts/version.py bump minor` |
| Bump major | `python scripts/version.py bump major` |
| Set version | `python scripts/version.py set X.Y.Z` |
| Create release | Push tag `vX.Y.Z` to GitHub |

---

## üìñ References

- [Semantic Versioning 2.0.0](https://semver.org/)
- [Keep a Changelog](https://keepachangelog.com/)
- [GitHub Releases](https://docs.github.com/en/repositories/releasing-projects-on-github)

---

**Last Updated**: 2025-11-10
**Maintained By**: FraiseQL Team
